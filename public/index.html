<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GMB Veri √áekici | Google Maps</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary: #4f46e5; --primary-light: #818cf8; --success: #10b981;
      --error: #ef4444; --warning: #f59e0b; --info: #3b82f6;
      --bg-dark: #0f172a; --bg-card: #1e293b; --bg-card-hover: #334155;
      --text-primary: #f8fafc; --text-secondary: #94a3b8; --text-muted: #64748b;
      --border-color: #334155;
    }
    body { font-family: 'Inter', sans-serif; background: var(--bg-dark); color: var(--text-primary); min-height: 100vh; }
    .container { max-width: 1400px; margin: 0 auto; padding: 1.5rem; }
    .header { text-align: center; margin-bottom: 1.5rem; }
    .header h1 { font-size: 2rem; background: linear-gradient(135deg, #4f46e5, #7c3aed); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .header p { color: var(--text-secondary); font-size: 0.9rem; }
    
    .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
    @media (max-width: 1024px) { .main-grid { grid-template-columns: 1fr; } }
    
    .card { background: var(--bg-card); border-radius: 14px; padding: 1.25rem; border: 1px solid var(--border-color); }
    .card-header { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border-color); }
    .card-header h2 { font-size: 1.1rem; flex: 1; }
    
    .tabs { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
    .tab { padding: 0.6rem 1rem; background: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; font-size: 0.85rem; color: var(--text-secondary); transition: all 0.2s; }
    .tab:hover { border-color: var(--primary-light); }
    .tab.active { background: rgba(79, 70, 229, 0.2); border-color: var(--primary); color: var(--text-primary); }
    
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    .form-group { margin-bottom: 1rem; }
    .form-group label { display: block; font-weight: 500; margin-bottom: 0.4rem; color: var(--text-secondary); font-size: 0.85rem; }
    select, input, textarea { width: 100%; padding: 0.7rem 1rem; background: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 0.9rem; font-family: inherit; }
    select:focus, input:focus, textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2); }
    textarea { resize: vertical; min-height: 80px; }
    
    .toggle-group { display: flex; align-items: center; justify-content: space-between; padding: 0.6rem 1rem; background: var(--bg-dark); border-radius: 8px; border: 1px solid var(--border-color); }
    .toggle-label span { font-weight: 500; font-size: 0.85rem; }
    .toggle-label small { color: var(--text-muted); font-size: 0.75rem; display: block; }
    .toggle-switch { position: relative; width: 44px; height: 24px; }
    .toggle-switch input { opacity: 0; width: 0; height: 0; }
    .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: var(--border-color); border-radius: 24px; transition: 0.3s; }
    .toggle-slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background: white; border-radius: 50%; transition: 0.3s; }
    .toggle-switch input:checked + .toggle-slider { background: var(--success); }
    .toggle-switch input:checked + .toggle-slider:before { transform: translateX(20px); }
    
    .sector-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 0.4rem; max-height: 280px; overflow-y: auto; padding: 0.25rem; }
    .sector-item { display: flex; align-items: center; gap: 0.4rem; padding: 0.5rem 0.7rem; background: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 6px; cursor: pointer; font-size: 0.8rem; transition: all 0.2s; }
    .sector-item:hover { border-color: var(--primary-light); }
    .sector-item.selected { border-color: var(--primary); background: rgba(79, 70, 229, 0.15); }
    .sector-item input { width: auto; }
    
    .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.8rem 1.5rem; border: none; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s; }
    .btn-primary { background: linear-gradient(135deg, #4f46e5, #7c3aed); color: white; width: 100%; }
    .btn-primary:hover:not(:disabled) { transform: translateY(-1px); box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3); }
    .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }
    .btn-download { background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 0.6rem 1rem; font-size: 0.85rem; }
    .btn-sm { padding: 0.35rem 0.7rem; font-size: 0.75rem; background: var(--bg-dark); border: 1px solid var(--border-color); color: var(--text-secondary); border-radius: 5px; cursor: pointer; }
    .btn-sm:hover { border-color: var(--primary); color: var(--text-primary); }
    
    .info-box { background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); padding: 0.5rem 0.75rem; border-radius: 6px; font-size: 0.8rem; color: var(--info); margin-bottom: 1rem; }
    .info-box strong { color: var(--text-primary); }
    
    .quick-stats { display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap; }
    .stat-chip { background: var(--bg-dark); padding: 0.35rem 0.7rem; border-radius: 12px; font-size: 0.75rem; color: var(--text-secondary); }
    .stat-chip strong { color: var(--text-primary); }
    .stat-chip.success { background: rgba(16, 185, 129, 0.15); color: var(--success); }
    
    .progress-bar { height: 6px; background: var(--bg-dark); border-radius: 3px; overflow: hidden; margin-bottom: 0.4rem; }
    .progress-fill { height: 100%; background: linear-gradient(135deg, #4f46e5, #7c3aed); border-radius: 3px; transition: width 0.3s; }
    .progress-text { display: flex; justify-content: space-between; color: var(--text-secondary); font-size: 0.75rem; }
    
    .status-badge { display: inline-flex; align-items: center; gap: 0.3rem; padding: 0.3rem 0.6rem; border-radius: 12px; font-size: 0.75rem; font-weight: 500; }
    .status-pending { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
    .status-running { background: rgba(59, 130, 246, 0.2); color: var(--info); }
    .status-completed { background: rgba(16, 185, 129, 0.2); color: var(--success); }
    .status-error { background: rgba(239, 68, 68, 0.2); color: var(--error); }
    .status-dot { width: 6px; height: 6px; border-radius: 50%; animation: pulse 2s infinite; }
    .status-running .status-dot { background: var(--info); }
    .status-completed .status-dot { background: var(--success); animation: none; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    
    .current-info { background: rgba(79, 70, 229, 0.1); border: 1px solid var(--primary); padding: 0.5rem 0.75rem; border-radius: 6px; margin-bottom: 0.75rem; font-size: 0.8rem; }
    .current-info span { color: var(--primary-light); }
    .neighborhood-badge { background: rgba(16, 185, 129, 0.15); color: var(--success); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; margin-left: 0.5rem; }
    
    .log-container { background: var(--bg-dark); border-radius: 8px; padding: 0.6rem; height: 320px; overflow-y: auto; font-family: 'Consolas', monospace; font-size: 0.75rem; border: 1px solid var(--border-color); }
    .log-entry { padding: 0.15rem 0; border-bottom: 1px solid rgba(255,255,255,0.02); }
    .log-time { color: var(--text-muted); margin-right: 0.4rem; font-size: 0.7rem; }
    .log-info { color: var(--info); }
    .log-success { color: var(--success); }
    .log-error { color: var(--error); }
    .log-warning { color: var(--warning); }
    .log-progress { color: var(--primary-light); }
    .log-neighborhood { color: #22d3ee; }
    .log-cache { color: #a78bfa; }
    
    .results-section { margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color); }
    .results-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; margin-bottom: 0.75rem; }
    .result-stat { background: var(--bg-dark); padding: 0.6rem; border-radius: 6px; text-align: center; }
    .result-stat .value { font-size: 1.3rem; font-weight: 700; color: var(--primary-light); }
    .result-stat .label { font-size: 0.7rem; color: var(--text-muted); }
    .download-buttons { display: flex; gap: 0.5rem; }
    
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <h1>üó∫Ô∏è GMB Veri √áekici</h1>
      <p>Google Maps'ten i≈ületme bilgilerini √ßekin (Sadece isim + telefon)</p>
    </header>

    <div class="main-grid">
      <div class="card">
        <div class="card-header">
          <span>‚öôÔ∏è</span>
          <h2>Ayarlar</h2>
        </div>

        <div class="tabs">
          <button class="tab active" data-tab="sectors">üìã Sekt√∂rler</button>
          <button class="tab" data-tab="custom">‚úèÔ∏è √ñzel Arama</button>
        </div>

        <!-- Sekt√∂r Se√ßimi -->
        <div class="tab-content active" id="tab-sectors">
          <div class="form-group">
            <label>üìç ƒ∞l√ße</label>
            <select id="district" required>
              <option value="">ƒ∞l√ße se√ßin...</option>
            </select>
          </div>

          <div class="form-group">
            <div class="toggle-group">
              <div class="toggle-label">
                <span>üèòÔ∏è Mahalle Bazlƒ± Arama</span>
                <small>Daha fazla sonu√ß i√ßin mahallelerde arar</small>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="useNeighborhoods" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>

          <div class="info-box" id="neighborhoodInfo">
            <strong id="neighborhoodCount">0</strong> mahallede arama yapƒ±lacak
          </div>

          <div class="form-group">
            <label>üè¢ Sekt√∂rler</label>
            <div style="display: flex; gap: 0.4rem; margin-bottom: 0.5rem;">
              <button type="button" class="btn-sm" onclick="selectAll()">T√ºm√º</button>
              <button type="button" class="btn-sm" onclick="deselectAll()">Temizle</button>
              <button type="button" class="btn-sm" onclick="selectHighPotential()">Y√ºksek Pot.</button>
            </div>
            <div class="sector-grid" id="sectorGrid"></div>
          </div>

          <div class="quick-stats">
            <span class="stat-chip">Se√ßili: <strong id="selectedCount">0</strong></span>
            <span class="stat-chip success" id="estimatedTime">~5 dk</span>
          </div>

          <button type="button" class="btn btn-primary" id="startBtn" onclick="startSectorScrape()">
            üöÄ Ba≈ülat
          </button>
        </div>

        <!-- √ñzel Arama -->
        <div class="tab-content" id="tab-custom">
          <div class="form-group">
            <label>üìç ƒ∞l√ße</label>
            <select id="customDistrict" required>
              <option value="">ƒ∞l√ße se√ßin...</option>
            </select>
          </div>

          <div class="form-group">
            <div class="toggle-group">
              <div class="toggle-label">
                <span>üèòÔ∏è Mahalle Bazlƒ± Arama</span>
                <small>Daha fazla sonu√ß i√ßin mahallelerde arar</small>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="customUseNeighborhoods" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>

          <div class="form-group">
            <label>üîç Anahtar Kelimeler (virg√ºlle ayƒ±rƒ±n)</label>
            <textarea id="customKeywords" placeholder="√∂rn: berber, kuaf√∂r, g√ºzellik salonu"></textarea>
          </div>

          <div class="form-group">
            <label>üìõ Arama Adƒ± (opsiyonel)</label>
            <input type="text" id="customName" placeholder="√∂rn: Kuaf√∂rler">
          </div>

          <button type="button" class="btn btn-primary" id="customStartBtn" onclick="startCustomScrape()">
            üöÄ √ñzel Aramayƒ± Ba≈ülat
          </button>
        </div>

        <!-- Sonu√ßlar -->
        <div class="results-section hidden" id="resultsSection">
          <h3 style="font-size: 0.95rem; margin-bottom: 0.6rem;">üìä Sonu√ßlar</h3>
          <div class="results-grid">
            <div class="result-stat">
              <div class="value" id="statTotal">0</div>
              <div class="label">Taranan</div>
            </div>
            <div class="result-stat">
              <div class="value" id="statWithPhone">0</div>
              <div class="label">Telefon</div>
            </div>
            <div class="result-stat">
              <div class="value" id="statCache">0</div>
              <div class="label">Cache</div>
            </div>
            <div class="result-stat">
              <div class="value" id="statProgress">0%</div>
              <div class="label">ƒ∞lerleme</div>
            </div>
          </div>
          <div class="download-buttons hidden" id="downloadButtons">
            <button class="btn btn-download" onclick="downloadFile('xlsx')">üìä Excel</button>
            <button class="btn btn-download" onclick="downloadFile('txt')">üìÑ TXT</button>
          </div>
        </div>
      </div>

      <!-- Saƒü Panel -->
      <div class="card">
        <div class="card-header">
          <span>üìã</span>
          <h2>ƒ∞≈ülem Durumu</h2>
          <span class="status-badge status-pending" id="statusBadge">
            <span class="status-dot"></span>
            <span id="statusText">Bekliyor</span>
          </span>
        </div>

        <div class="current-info hidden" id="currentInfoBox">
          <span id="currentSectorName">-</span>
          <span class="neighborhood-badge hidden" id="neighborhoodBadge">-</span>
        </div>

        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
          </div>
          <div class="progress-text">
            <span id="progressText">Ba≈ülamadƒ±</span>
            <span id="progressPercent">0%</span>
          </div>
        </div>

        <div style="margin-top: 0.75rem;">
          <label style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.3rem; display: block;">üìù Canlƒ± Log</label>
          <div class="log-container" id="logContainer">
            <div class="log-entry"><span class="log-time">[--:--]</span><span class="log-info">Ba≈ülamayƒ± bekliyor...</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = 'http://localhost:3001/api';
    let currentJobId = null;
    let logEventSource = null;
    let statusInterval = null;
    let sectorsData = [];

    document.addEventListener('DOMContentLoaded', () => {
      loadDistricts();
      loadSectors();
      setupTabs();
      document.getElementById('district').addEventListener('change', updateNeighborhoodCount);
      document.getElementById('customDistrict').addEventListener('change', () => {});
    });

    function setupTabs() {
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          tab.classList.add('active');
          document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
        });
      });
    }

    async function loadDistricts() {
      try {
        const res = await fetch(`${API_BASE}/districts`);
        const districts = await res.json();
        ['district', 'customDistrict'].forEach(id => {
          const select = document.getElementById(id);
          districts.forEach(d => {
            const option = document.createElement('option');
            option.value = d;
            option.textContent = d;
            select.appendChild(option);
          });
        });
      } catch (error) {
        addLocalLog('error', 'ƒ∞l√ßeler y√ºklenemedi');
      }
    }

    async function updateNeighborhoodCount() {
      const district = document.getElementById('district').value;
      if (!district) { document.getElementById('neighborhoodCount').textContent = '0'; return; }
      try {
        const res = await fetch(`${API_BASE}/districts/${encodeURIComponent(district)}/neighborhoods`);
        const neighborhoods = await res.json();
        document.getElementById('neighborhoodCount').textContent = neighborhoods.length;
        updateEstimatedTime();
      } catch (error) { document.getElementById('neighborhoodCount').textContent = '?'; }
    }

    async function loadSectors() {
      try {
        const res = await fetch(`${API_BASE}/sectors`);
        sectorsData = await res.json();
        const grid = document.getElementById('sectorGrid');
        grid.innerHTML = '';
        sectorsData.forEach(s => {
          const div = document.createElement('label');
          div.className = 'sector-item';
          div.innerHTML = `<input type="checkbox" name="sectors" value="${s.id}" data-potansiyel="${s.potansiyel}"><span>${s.name}</span>`;
          div.querySelector('input').addEventListener('change', () => { updateSelectedCount(); updateEstimatedTime(); });
          grid.appendChild(div);
        });
        updateSelectedCount();
      } catch (error) { addLocalLog('error', 'Sekt√∂rler y√ºklenemedi'); }
    }

    function selectAll() { document.querySelectorAll('input[name="sectors"]').forEach(cb => { cb.checked = true; cb.closest('.sector-item').classList.add('selected'); }); updateSelectedCount(); updateEstimatedTime(); }
    function deselectAll() { document.querySelectorAll('input[name="sectors"]').forEach(cb => { cb.checked = false; cb.closest('.sector-item').classList.remove('selected'); }); updateSelectedCount(); updateEstimatedTime(); }
    function selectHighPotential() {
      document.querySelectorAll('input[name="sectors"]').forEach(cb => {
        const p = cb.dataset.potansiyel || '';
        cb.checked = p.includes('√áok y√ºksek') || p.includes('Y√ºksek');
        cb.closest('.sector-item').classList.toggle('selected', cb.checked);
      });
      updateSelectedCount(); updateEstimatedTime();
    }
    function updateSelectedCount() {
      const count = document.querySelectorAll('input[name="sectors"]:checked').length;
      document.getElementById('selectedCount').textContent = count;
      document.querySelectorAll('input[name="sectors"]').forEach(cb => cb.closest('.sector-item').classList.toggle('selected', cb.checked));
    }
    function updateEstimatedTime() {
      const sectors = document.querySelectorAll('input[name="sectors"]:checked').length;
      const nh = parseInt(document.getElementById('neighborhoodCount').textContent) || 1;
      const useNh = document.getElementById('useNeighborhoods').checked;
      let mins = Math.ceil((sectors * 3 * (useNh ? nh : 1) * 0.5 + sectors * 30) / 60);
      document.getElementById('estimatedTime').textContent = `~${mins} dk`;
    }

    async function startSectorScrape() {
      const district = document.getElementById('district').value;
      const sectors = Array.from(document.querySelectorAll('input[name="sectors"]:checked')).map(cb => cb.value);
      const useNeighborhoods = document.getElementById('useNeighborhoods').checked;
      if (!district) { alert('ƒ∞l√ße se√ßin'); return; }
      if (sectors.length === 0) { alert('Sekt√∂r se√ßin'); return; }
      await startJob('/scrape', { district, sectors, useNeighborhoods });
    }

    async function startCustomScrape() {
      const district = document.getElementById('customDistrict').value;
      const keywords = document.getElementById('customKeywords').value;
      const customName = document.getElementById('customName').value;
      const useNeighborhoods = document.getElementById('customUseNeighborhoods').checked;
      if (!district) { alert('ƒ∞l√ße se√ßin'); return; }
      if (!keywords.trim()) { alert('Anahtar kelime girin'); return; }
      await startJob('/scrape/custom', { district, keywords, customName, useNeighborhoods });
    }

    async function startJob(endpoint, body) {
      document.getElementById('startBtn').disabled = true;
      document.getElementById('customStartBtn').disabled = true;
      document.getElementById('logContainer').innerHTML = '';
      document.getElementById('resultsSection').classList.remove('hidden');
      document.getElementById('downloadButtons').classList.add('hidden');
      
      try {
        const res = await fetch(`${API_BASE}${endpoint}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
        const data = await res.json();
        if (data.error) throw new Error(data.error);
        currentJobId = data.jobId;
        addLocalLog('success', `ƒ∞≈ülem ba≈ülatƒ±ldƒ±`);
        startStatusPolling();
        startLogStreaming();
        updateStatus('running', '√áalƒ±≈üƒ±yor');
      } catch (error) {
        document.getElementById('startBtn').disabled = false;
        document.getElementById('customStartBtn').disabled = false;
        addLocalLog('error', error.message);
        updateStatus('error', 'Hata');
      }
    }

    function startStatusPolling() {
      if (statusInterval) clearInterval(statusInterval);
      statusInterval = setInterval(async () => {
        try {
          const res = await fetch(`${API_BASE}/job/${currentJobId}`);
          const job = await res.json();
          document.getElementById('progressFill').style.width = `${job.progress}%`;
          document.getElementById('progressPercent').textContent = `${job.progress}%`;
          document.getElementById('statProgress').textContent = `${job.progress}%`;
          document.getElementById('statTotal').textContent = job.totalPlaces || 0;
          document.getElementById('statWithPhone').textContent = job.totalBusinesses || 0;
          document.getElementById('statCache').textContent = job.cacheHits || 0;
          if (job.processedPlaces) document.getElementById('progressText').textContent = `${job.processedPlaces}/${job.totalPlaces}`;
          
          // Mahalle g√∂sterimi
          if (job.currentNeighborhood) {
            document.getElementById('currentInfoBox').classList.remove('hidden');
            document.getElementById('neighborhoodBadge').classList.remove('hidden');
            document.getElementById('neighborhoodBadge').textContent = `üèòÔ∏è ${job.currentNeighborhood} (${job.neighborhoodProgress?.current || 0}/${job.neighborhoodProgress?.total || 0})`;
          } else {
            document.getElementById('neighborhoodBadge').classList.add('hidden');
          }
          
          if (job.status === 'completed') {
            updateStatus('completed', 'Tamamlandƒ±');
            clearInterval(statusInterval);
            document.getElementById('startBtn').disabled = false;
            document.getElementById('customStartBtn').disabled = false;
            document.getElementById('downloadButtons').classList.remove('hidden');
            document.getElementById('currentInfoBox').classList.add('hidden');
          } else if (job.status === 'error') {
            updateStatus('error', 'Hata');
            clearInterval(statusInterval);
            document.getElementById('startBtn').disabled = false;
            document.getElementById('customStartBtn').disabled = false;
          }
        } catch (e) {}
      }, 800);
    }

    function startLogStreaming() {
      if (logEventSource) logEventSource.close();
      logEventSource = new EventSource(`${API_BASE}/job/${currentJobId}/logs?since=0`);
      logEventSource.onmessage = (event) => {
        const data = JSON.parse(event.data);
        if (data.logs) data.logs.forEach(log => addLogEntry(log));
        if (data.done) logEventSource.close();
      };
      logEventSource.onerror = () => logEventSource.close();
    }

    function addLogEntry(log) {
      const container = document.getElementById('logContainer');
      const div = document.createElement('div');
      div.className = 'log-entry';
      const time = new Date(log.timestamp).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
      div.innerHTML = `<span class="log-time">[${time}]</span><span class="log-${log.type}">${log.message}</span>`;
      container.appendChild(div);
      container.scrollTop = container.scrollHeight;
    }

    function addLocalLog(type, message) {
      const container = document.getElementById('logContainer');
      const div = document.createElement('div');
      div.className = 'log-entry';
      const time = new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
      div.innerHTML = `<span class="log-time">[${time}]</span><span class="log-${type}">${message}</span>`;
      container.appendChild(div);
      container.scrollTop = container.scrollHeight;
    }

    function updateStatus(status, text) {
      const badge = document.getElementById('statusBadge');
      badge.className = `status-badge status-${status}`;
      document.getElementById('statusText').textContent = text;
    }

    function downloadFile(format) {
      if (currentJobId) window.location.href = `${API_BASE}/job/${currentJobId}/download/${format}`;
    }
  </script>
</body>
</html>
